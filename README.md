# Telehealth Application

A full-stack MERN telehealth platform with real-time video consultations, secure PHI data handling, payment processing, and AI-powered transcription.

## ğŸ—ï¸ Architecture

### Tech Stack

**Frontend:**
- React 18 with JavaScript
- Vite for build tooling
- Tailwind CSS for styling
- Socket.io-client for real-time communication
- Axios for API calls
- WebRTC for video/audio streaming

**Backend:**
- Node.js with Express
- JavaScript (ES Modules)
- Prisma ORM with MongoDB
- Socket.io for WebRTC signaling
- JWT authentication
- Square Payments API
- Deepgram API for transcription (with OpenAI Whisper fallback)

**Security:**
- AES encryption for PHI data
- JWT-based authentication
- Role-based access control (PATIENT, DOCTOR, ADMIN)
- Secure WebSocket connections

## ğŸ“ Project Structure

```
biologic/
â”œâ”€â”€ frontend/                 # React frontend application (JavaScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # Reusable React components
â”‚   â”‚   â”œâ”€â”€ context/         # React context providers (Auth)
â”‚   â”‚   â”œâ”€â”€ pages/           # Page components (Login, Dashboard, etc.)
â”‚   â”‚   â”œâ”€â”€ App.jsx          # Main app component with routing
â”‚   â”‚   â”œâ”€â”€ main.jsx         # Application entry point
â”‚   â”‚   â””â”€â”€ index.css        # Tailwind CSS imports
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ .env.template        # Environment variables template
â”‚
â””â”€â”€ backend/                 # Node.js backend API
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ routes/          # Express route handlers
    â”‚   â”‚   â”œâ”€â”€ auth.js      # Authentication routes
    â”‚   â”‚   â”œâ”€â”€ appointments.js
    â”‚   â”‚   â”œâ”€â”€ payment.js
    â”‚   â”‚   â”œâ”€â”€ doctors.js
    â”‚   â”‚   â””â”€â”€ admin.js
    â”‚   â”œâ”€â”€ middleware/      # Express middleware
    â”‚   â”‚   â””â”€â”€ auth.js      # JWT authentication & authorization
    â”‚   â”œâ”€â”€ services/        # External service integrations
    â”‚   â”‚   â”œâ”€â”€ deepgram.js  # Speech-to-text transcription
    â”‚   â”‚   â””â”€â”€ payment.js   # Square payment processing
    â”‚   â”œâ”€â”€ socket/          # WebSocket handlers
    â”‚   â”‚   â””â”€â”€ signaling.js # WebRTC signaling server
    â”‚   â”œâ”€â”€ utils/           # Utility functions
    â”‚   â”‚   â”œâ”€â”€ encryption.js # PHI data encryption/decryption
    â”‚   â”‚   â””â”€â”€ jwt.js       # JWT token generation/verification
    â”‚   â””â”€â”€ server.js        # Main server entry point
    â”œâ”€â”€ prisma/
    â”‚   â””â”€â”€ schema.prisma    # Database schema definition
    â”œâ”€â”€ package.json
    â””â”€â”€ .env.template        # Environment variables template

```

## ğŸ—„ï¸ Database Schema

### Models

**User** - Patients, doctors, and admins
- Authentication fields (email, password)
- Role-based access (PATIENT | DOCTOR | ADMIN)
- Linked to PatientInfo or DoctorInfo

**PatientInfo** - Patient-specific encrypted PHI
- Medical history, allergies, medications (encrypted)

**DoctorInfo** - Doctor credentials
- Specialty, license number, availability

**Appointment** - Consultation bookings
- Links patient and doctor
- Encrypted health concerns and symptoms
- Unique room ID for WebRTC sessions
- Status tracking (PENDING | CONFIRMED | COMPLETED | CANCELLED)

**Payment** - Transaction records
- Square payment integration
- Payment status and receipt URLs

**ChatMessage** - In-session chat history
- Encrypted message content
- Linked to appointments

**Transcript** - Session transcriptions
- Encrypted full transcript
- Generated by Deepgram/Whisper

**AuditLog** - Compliance and security audit trail

## ğŸš€ Setup Instructions

### Prerequisites

- Node.js 18+ and npm/yarn
- MongoDB database (local or cloud like MongoDB Atlas)
- Square developer account (for payments)
- Deepgram API key (for transcription)

### 1. Clone and Install

```bash
# Install frontend dependencies
cd frontend
npm install

# Install backend dependencies
cd ../backend
npm install
```

### 2. Environment Configuration

**Frontend (.env)**
```bash
cp frontend/.env.template frontend/.env
```

Edit `frontend/.env`:
```
VITE_API_URL=http://localhost:5000/api
VITE_SOCKET_URL=http://localhost:5000
VITE_SQUARE_APPLICATION_ID=your_square_app_id
VITE_SQUARE_LOCATION_ID=your_square_location_id
```

**Backend (.env)**
```bash
cp backend/.env.template backend/.env
```

Edit `backend/.env`:
```
DATABASE_URL="mongodb+srv://username:password@cluster.mongodb.net/telehealth"
PORT=5000
JWT_SECRET=your_super_secret_jwt_key
SQUARE_ACCESS_TOKEN=your_square_access_token
SQUARE_LOCATION_ID=your_square_location_id
DEEPGRAM_API_KEY=your_deepgram_api_key
OPENAI_API_KEY=your_openai_api_key
ENCRYPTION_KEY=your_32_character_encryption_key
FRONTEND_URL=http://localhost:3000
```

### 3. Database Setup

```bash
cd backend

# Generate Prisma Client
npm run prisma:generate

# Run database migrations
npm run prisma:migrate

# (Optional) Open Prisma Studio to view data
npm run prisma:studio
```

### 4. Run the Application

**Terminal 1 - Backend:**
```bash
cd backend
npm run dev
```

**Terminal 2 - Frontend:**
```bash
cd frontend
npm run dev
```

The application will be available at:
- Frontend: http://localhost:3000
- Backend API: http://localhost:5000

## ğŸ” Security Features

### PHI Data Protection
- All sensitive patient data is encrypted at rest using AES-256
- Medical history, symptoms, chat messages, and transcripts are encrypted
- Encryption keys are stored securely in environment variables

### Authentication & Authorization
- JWT-based authentication with token expiration
- Role-based access control (RBAC)
- Protected routes and API endpoints
- Secure WebSocket connections with token verification

### Audit Logging
- All admin actions are logged
- Compliance-ready audit trail
- User action tracking

## ğŸ¥ WebRTC Video Consultation

### Features
- Peer-to-peer video and audio streaming
- Real-time chat during consultation
- Live transcription with Deepgram
- Screen sharing capability
- Automatic session recording

### Flow
1. Patient books and pays for appointment
2. Doctor accepts appointment
3. Both parties join secure WebRTC room
4. Socket.io handles signaling (offer/answer/ICE)
5. Direct peer-to-peer media connection established
6. Chat and transcription run in real-time
7. Session data saved to database upon completion

## ğŸ’³ Payment Integration

### Square Payments
- Secure payment processing before consultation
- PCI-compliant payment handling
- Payment status tracking
- Automatic receipt generation
- Refund support

### Flow
1. Patient selects doctor and fills booking form
2. Redirected to Square payment page
3. Payment validated server-side
4. Appointment confirmed upon successful payment
5. Doctor notified and can accept consultation

## ğŸ¤ Voice Transcription

### Deepgram Integration
- Real-time speech-to-text during video calls
- Live subtitles/captions
- Full transcript saved to database (encrypted)

### Whisper Fallback
- OpenAI Whisper API as backup
- Post-session transcription if Deepgram fails

## ğŸ“Š Admin Dashboard

### Features
- User management (view/delete users)
- Doctor management (view credentials)
- Appointment oversight
- Audit log review
- System analytics

## ğŸ§ª API Endpoints

### Authentication
- `POST /api/auth/register` - Register new user
- `POST /api/auth/login` - User login
- `GET /api/auth/me` - Get current user

### Appointments
- `GET /api/appointments` - Get user appointments
- `POST /api/appointments` - Create appointment
- `PATCH /api/appointments/:id/accept` - Doctor accepts
- `PATCH /api/appointments/:id/complete` - Mark completed

### Payments
- `POST /api/payment` - Process payment
- `GET /api/payment/:appointmentId` - Get payment status

### Doctors
- `GET /api/doctors` - Get available doctors (filter by specialty)

### Admin (ADMIN role only)
- `GET /api/admin/users` - Get all users
- `GET /api/admin/doctors` - Get all doctors
- `GET /api/admin/appointments` - Get all appointments
- `GET /api/admin/audit-logs` - Get audit logs
- `DELETE /api/admin/users/:id` - Delete user

## ğŸ“ Development

### Frontend Development
```bash
cd frontend
npm run dev      # Start dev server
npm run build    # Build for production
npm run preview  # Preview production build
```

### Backend Development
```bash
cd backend
npm run dev      # Start with hot reload (nodemon)
npm start        # Run production server
```

## ğŸš¢ Deployment

### Frontend (Vercel/Netlify)
1. Build the frontend: `npm run build`
2. Deploy the `dist` folder
3. Set environment variables in hosting platform

### Backend (Heroku/Railway/AWS)
1. Deploy the backend directly (no build step needed)
2. Set Node.js runtime (18+)
3. Set all environment variables
4. Ensure MongoDB connection string is correct

### Environment Variables
- Never commit `.env` files
- Use `.env.template` as reference
- Set variables in deployment platform
- Use strong, unique secrets in production

## ğŸ›¡ï¸ Compliance Considerations

This application handles Protected Health Information (PHI). For production use:

- âœ… Data encryption at rest and in transit
- âœ… Audit logging for compliance
- âœ… Role-based access control
- âš ï¸ Consider HIPAA compliance requirements
- âš ï¸ Implement data backup and disaster recovery
- âš ï¸ Add user consent and privacy policy
- âš ï¸ Regular security audits
- âš ï¸ Implement data retention policies

## ğŸ“š Additional Resources

- [Prisma Documentation](https://www.prisma.io/docs/)
- [Socket.io Documentation](https://socket.io/docs/)
- [WebRTC Guide](https://webrtc.org/getting-started/overview)
- [Deepgram API](https://developers.deepgram.com/)
- [Square Payments](https://developer.squareup.com/docs/payments-api/overview)

## ğŸ“„ License

This project is for educational and demonstration purposes.

## ğŸ¤ Contributing

Contributions, issues, and feature requests are welcome!

---

**Built with â¤ï¸ for secure, accessible healthcare**
